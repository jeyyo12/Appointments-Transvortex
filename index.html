<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Pagini Facebook - Transvortex LTD</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-bg-glow"></div>
            <div class="header-noise"></div>
            <div class="header-wrapper">
                <div class="logo-container">
                    <div class="logo-glow"></div>
                    <img src="Images/Logo.png" alt="Transvortex LTD Logo" class="logo-large">
                </div>
                <div class="header-content">
                    <div class="title-wrapper">
                        <h1 class="header-title">
                            <span class="glow-text">Manager</span>
                            <span class="highlight-orange">Pagini</span>
                            <span class="glow-text">Facebook</span>
                        </h1>
                        <div class="accent-line"></div>
                    </div>
                    <p class="header-subtitle">
                        <span class="subtitle-highlight">Organizează-ți</span> postările zilnice 
                        <span class="subtitle-bold">pentru compania ta</span>
                    </p>
                </div>
            </div>
        </header>

        <main>
            <!-- Formular adăugare pagină nouă -->
            <section class="add-section">
                <h2><i class="fab fa-facebook"></i> Adaugă Pagină Nouă</h2>
                <form id="pageForm">
                    <div class="form-group">
                        <label for="pageName">Nume Pagină:</label>
                        <input type="text" id="pageName" placeholder="ex: Transvortex LTD Official" required>
                    </div>
                    <div class="form-group">
                        <label for="pageUrl">URL Pagină Facebook:</label>
                        <input type="url" id="pageUrl" placeholder="https://facebook.com/..." required>
                    </div>
                    <div class="form-group">
                        <label for="pageAvatar">URL Avatar (opțional):</label>
                        <input type="url" id="pageAvatar" placeholder="https://... (logo sau poză de profil)">
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-plus"></i> Adaugă Pagină
                    </button>
                </form>
            </section>

            <!-- Status în timp real -->
            <section class="live-status">
                <div class="status-item">
                    <span class="status-indicator active"></span>
                    <div class="status-content">
                        <strong>Ultima postare:</strong>
                        <span id="lastPostTime">-</span>
                    </div>
                </div>
                <div class="status-item">
                    <span class="status-indicator pending"></span>
                    <div class="status-content">
                        <strong>Următoarea postare:</strong>
                        <span id="nextPostTime">-</span>
                    </div>
                </div>
                <div class="human-message" id="humanMessage">
                    <i class="fas fa-heart"></i>
                    <span>Totul este pregătit pentru astăzi.</span>
                </div>
            </section>

            <!-- Statistici rapide -->
            <section class="stats-section">
                <div class="stat-card">
                    <i class="fas fa-list"></i>
                    <div class="stat-content">
                        <h3 id="totalPages">0</h3>
                        <p>Pagini Totale</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar-check"></i>
                    <div class="stat-content">
                        <h3 id="postedToday">0</h3>
                        <p>Postat Astăzi</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock"></i>
                    <div class="stat-content">
                        <h3 id="pendingPages">0</h3>
                        <p>De Postat</p>
                    </div>
                </div>
            </section>

            <!-- Lista de pagini -->
            <section class="pages-section">
                <div class="section-header">
                    <h2><i class="fas fa-th-list"></i> Paginile Mele Facebook</h2>
                </div>
                
                <div id="pagesList" class="pages-grid">
                    <!-- Paginile vor fi adăugate dinamic aici -->
                </div>

                <div id="emptyState" class="empty-state">
                    <i class="fas fa-folder-open"></i>
                    <h3>Nicio pagină adăugată încă</h3>
                    <p>Începe prin a adăuga prima ta pagină Facebook folosind formularul de mai sus</p>
                </div>
            </section>

            <!-- Secțiune Listă Invitați (Firebase) -->
            <section class="add-section">
                <h2><i class="fas fa-users"></i> Listă Invitați (Sincronizare Cloud)</h2>
                <form id="guestForm">
                    <div class="form-group">
                        <label for="guestName">Nume Invitat:</label>
                        <input type="text" id="guestName" placeholder="ex: Ion Popescu" required>
                    </div>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-user-plus"></i> Adaugă Invitat
                    </button>
                </form>
                
                <div id="guestListContainer" style="margin-top: 2rem;">
                    <h3 style="margin-bottom: 1rem; color: #1F1F1F;">
                        <i class="fas fa-list"></i> Invitați Confirmați
                    </h3>
                    <ul id="guestList" style="list-style: none; padding: 0;">
                        <li class="empty" style="text-align: center; color: #8A7F78; padding: 2rem;">
                            <i class="fas fa-spinner fa-spin"></i> Se încarcă...
                        </li>
                    </ul>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2026 Transvortex LTD. Toate drepturile rezervate.</p>
        </footer>
    </div>

    <script src="script.js"></script>

    <!-- Firebase SDK - Guest List Sync -->
    <script type="module">
        // Import Firebase modules (browser modular SDK)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            getDocs,
            query,
            orderBy,
            onSnapshot
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDKyqAb198h6VdbHXZtciMdn_KIg-L2zzU",
            authDomain: "transvortexltdcouk.firebaseapp.com",
            projectId: "transvortexltdcouk",
            storageBucket: "transvortexltdcouk.firebasestorage.app",
            messagingSenderId: "980773899679",
            appId: "1:980773899679:web:0880ca927f4ac348581aa",
            measurementId: "G-D1QH23H9J8"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Get DOM elements
        const form = document.getElementById('guestForm');
        const input = document.getElementById('guestName');
        const list = document.getElementById('guestList');

        /**
         * Render guests to the UI
         * @param {Array} items - Array of guest objects
         */
        function renderGuests(items) {
            list.innerHTML = '';
            
            if (!items || items.length === 0) {
                list.innerHTML = `
                    <li class="empty" style="text-align: center; color: #8A7F78; padding: 2rem;">
                        <i class="fas fa-user-friends"></i><br>
                        Niciun invitat adăugat încă.<br>
                        <small>Adaugă primul invitat folosind formularul de mai sus.</small>
                    </li>
                `;
                return;
            }

            items.forEach((guest, index) => {
                const li = document.createElement('li');
                li.style.cssText = `
                    background: #FDEEE3;
                    padding: 1rem 1.5rem;
                    margin-bottom: 0.5rem;
                    border-radius: 8px;
                    border-left: 4px solid #FF8A3D;
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    font-size: 1rem;
                    color: #1F1F1F;
                    transition: transform 0.2s;
                `;
                
                li.innerHTML = `
                    <span style="background: #FF8A3D; color: white; width: 32px; height: 32px; 
                                 border-radius: 50%; display: flex; align-items: center; 
                                 justify-content: center; font-weight: bold; font-size: 0.9rem;">
                        ${index + 1}
                    </span>
                    <span style="flex: 1; font-weight: 500;">${escapeHtml(guest.name)}</span>
                    <span style="font-size: 0.85rem; color: #8A7F78;">
                        <i class="fas fa-check-circle" style="color: #2ECC9A;"></i>
                    </span>
                `;
                
                // Hover effect
                li.addEventListener('mouseenter', () => {
                    li.style.transform = 'translateX(4px)';
                });
                li.addEventListener('mouseleave', () => {
                    li.style.transform = 'translateX(0)';
                });
                
                list.appendChild(li);
            });
        }

        /**
         * Escape HTML to prevent XSS
         * @param {string} text - Text to escape
         * @returns {string} - Escaped text
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        /**
         * Show error message
         * @param {string} message - Error message
         */
        function showError(message) {
            list.innerHTML = `
                <li class="empty" style="text-align: center; color: #EF4444; padding: 2rem;">
                    <i class="fas fa-exclamation-triangle"></i><br>
                    ${escapeHtml(message)}<br>
                    <small>Verifică conexiunea la internet și încearcă din nou.</small>
                </li>
            `;
        }

        /**
         * Load guests from Firestore
         * Uses real-time listener for instant sync across devices
         */
        function loadGuests() {
            try {
                const q = query(collection(db, 'guests'), orderBy('createdAt', 'desc'));
                
                // Real-time listener - updates instantly when data changes
                onSnapshot(q, (snapshot) => {
                    const items = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderGuests(items);
                }, (error) => {
                    console.error('Error loading guests:', error);
                    showError('Eroare la încărcarea invitaților.');
                });
            } catch (error) {
                console.error('Error setting up listener:', error);
                showError('Eroare la conectarea la baza de date.');
            }
        }

        /**
         * Add guest to Firestore
         * @param {string} name - Guest name
         */
        async function addGuest(name) {
            try {
                await addDoc(collection(db, 'guests'), {
                    name: name.trim(),
                    createdAt: Date.now()
                });
                // onSnapshot will automatically update the UI
            } catch (error) {
                console.error('Error adding guest:', error);
                alert('Eroare la adăugarea invitatului. Verifică conexiunea la internet.');
            }
        }

        /**
         * Form submit handler
         */
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = input.value.trim();
            if (!name) {
                alert('Te rog introdu un nume.');
                return;
            }

            // Disable form during submit
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Se adaugă...';

            try {
                await addGuest(name);
                input.value = ''; // Clear input on success
            } finally {
                // Re-enable form
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });

        // Start loading guests on page load
        loadGuests();
    </script>
</body>
</html>
